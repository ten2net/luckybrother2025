(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{6773:(e,t,o)=>{Promise.resolve().then(o.bind(o,3363))},3363:(e,t,o)=>{"use strict";o.r(t),o.d(t,{default:()=>a});var r=o(5155),l=o(2115),n=o(5570),i=o(1278),s=o(9253);let c=e=>{let{data:t,colors:o}=e,n=(0,l.useRef)(null);return(0,l.useEffect)(()=>{if(n.current){let e=(0,i.R9)(n.current,{layout:{background:{type:i.mE.Solid,color:o.backgroundColor},textColor:o.textColor},width:n.current.clientWidth,height:300,grid:{vertLines:{color:"rgba(197, 203, 206, 0.5)"},horzLines:{color:"rgba(197, 203, 206, 0.5)"}},timeScale:{rightOffset:1,barSpacing:1,fixLeftEdge:!0,tickMarkFormatter:e=>{let t=new Date(1e3*e);return console.log(t),(0,s.GP)(t,"MM-dd HH:mm")}}}),r=e.addCandlestickSeries({upColor:o.upColor,downColor:o.downColor,borderUpColor:o.borderUpColor,borderDownColor:o.borderDownColor,wickUpColor:o.wickUpColor,wickDownColor:o.wickDownColor}),l=t.map(e=>({time:Date.parse(e.time)/1e3,open:e.open,high:e.high,low:e.low,close:e.close,volume:e.volume,amoumt:e.amount}));r.setData(l),e.addLineSeries({color:"red",lineWidth:1,lineStyle:2,title:"多头线"}),e.addLineSeries({color:"green",lineWidth:1,lineStyle:2,title:"空头线"}),l.map(e=>({time:e.time,value:1.25*e.close})),l.map(e=>({time:e.time,value:.75*e.close}));let c=e.addLineSeries({color:"red",lineWidth:1,lineStyle:2,title:"情绪高涨，卖出"}),d=e.addLineSeries({color:"blue",lineWidth:1,lineStyle:1,title:"情绪低落，买入"});l.length>0&&(l.reduce((e,t)=>e+t.close,0),l.length,console.log(l),c.setData([{time:l[0].time,value:.18}]),d.setData([{time:l[0].time,value:-.08}]));let a=()=>{e.applyOptions({width:n.current.clientWidth})};return window.addEventListener("resize",a),()=>{window.removeEventListener("resize",a),e.remove()}}},[t,o]),(0,r.jsx)("div",{ref:n,style:{width:"100%",height:"305px"}})},d=()=>{let[e,t]=(0,l.useState)([]),[o,i]=(0,l.useState)([]),[s,d]=(0,l.useState)(!0),[a,h]=(0,l.useState)(null),u=e=>{let t=e.getHours().toString().padStart(2,"0"),o=e.getMinutes().toString().padStart(2,"0"),r=e.getSeconds().toString().padStart(2,"0");return"".concat(t,":").concat(o,":").concat(r)};return(0,l.useEffect)(()=>{let e=new n.Ros({encoding:"ascii",url:"http://192.168.15.131:8180/ws"});return e.on("connection",()=>{console.log("Connected to websocket server."),d(!1),new n.Topic({ros:e,name:"luckybrother2025/index_history",messageType:"luckybot_interface/msg/StockHistory"}).subscribe(e=>{console.log("Received message:",e),t(e.history)}),new n.Topic({ros:e,name:"luckybot/index",messageType:"std_msgs/msg/Float32"}).subscribe(e=>{console.log("Received message:",e.data);let t=u(new Date),o=Number(e.data);isNaN(o)?console.warn("Received invalid data:",e.data):i(e=>[{data:o,time:t}].concat(e))})}),e.on("close",()=>{console.log("Connection to websocket server closed."),d(!0)}),e.on("error",e=>{console.log("Error connecting to websocket server: ",e),d(!1),h("Error connecting to ROS 2 server")}),()=>{e.close()}},[]),(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{style:{textAlign:"center",fontWeight:"bold"},children:"情绪指数1分钟K线图，订阅自 luckybot 的 /luckybrother2005/index_history 主题"}),(0,r.jsx)(c,{data:e,colors:{backgroundColor:"white",textColor:"black",upColor:"#ef5350",downColor:"#26a69a",borderUpColor:"#b71c1c",borderDownColor:"#007063",wickUpColor:"#ef5350",wickDownColor:"#26a69a"}}),s&&(0,r.jsx)("p",{children:"正在连接到 ROS 2 服务器..."}),a&&(0,r.jsx)("p",{children:a}),(0,r.jsxs)("table",{children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{children:"序号"}),(0,r.jsx)("th",{children:"时间"}),(0,r.jsx)("th",{children:"情绪指数"})]})}),(0,r.jsx)("tbody",{children:o.map((e,t)=>t>20?"":(0,r.jsxs)("tr",{children:[(0,r.jsx)("td",{children:o.length-t}),(0,r.jsx)("td",{children:e.time}),(0,r.jsx)("td",{style:{textAlign:"right"},children:null!==e.data?e.data.toFixed(2):"N/A"})]},t))})]})]})};function a(){return(0,l.useEffect)(()=>{console.log("This is a client-side effect")},[]),(0,r.jsx)("div",{children:(0,r.jsx)(d,{})})}}},e=>{var t=t=>e(e.s=t);e.O(0,[63,441,517,358],()=>t(6773)),_N_E=e.O()}]);
